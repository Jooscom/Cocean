<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC	"-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd"
>
<mapper namespace="kr.co.cocean.store.dao.StoreDAO">	
	
	<select id="branchList" resultType="branch">
		SELECT * FROM branch
	</select>
	
	<select id="branchProductList" resultType="branchProduct">
		SELECT bp.productIndex, bp.branchID, bp.productID, bp.status, pi.productName, pi.category, 
    		pi.price, b.branchName, b.branchLocation, b.branchLatitude, b.branchLongitude
		FROM 
		    branchProduct bp
		INNER JOIN 
		    productInformation pi ON bp.productID = pi.productID
		INNER JOIN 
		    branch b ON bp.branchID = b.branchID
		ORDER BY 
    		bp.productId ASC
	</select>
	
	<select id="searchProduct" resultType="branchProduct">
	<!-- SELECT pi.productID, pi.productName, pi.price, bp.branchID, bp.status 
	FROM productInformation pi
	JOIN branchProduct bp ON pi.productID = bp.productID
	JOIN branch b ON bp.branchID = b.branchID
	WHERE pi.productName = #{param1} AND b.branchName = #{param2} -->
	<choose>
        <when test="branchName == '본사상품'">
        	select * from productInformation  where productName =#{searchKeyword}  AND category="상품"
        </when>
    	<otherwise>
			select  pi.productID, pi.productName, pi.price, bp.branchID, bp.status 
			FROM productInformation pi
            JOIN branchProduct bp ON pi.productID = bp.productID
            JOIN branch b ON bp.branchID = b.branchID
            WHERE pi.productName = #{searchKeyword} AND b.branchName = #{branchName}
    	</otherwise>
	</choose>
	</select>
	
	<insert id="brachRegister">
	INSERT INTO branch(branchName, branchLocation, branchLatitude, branchLongitude) 
	VALUES(#{param1},#{param2},#{param3},#{param4})
	</insert>
	
	<select id="branchSelect">
	SELECT branchID FROM branch WHERE branchName=#{param1}
	</select>
	
	<insert id="branchRegisterProduct">
	INSERT INTO branchProduct(branchID, productID) VALUES(#{param1}, #{param2})
	</insert>
	
	<insert id="ticketRegister">	
	INSERT INTO brachProduct(branchID, productID) VALUES(#{param1}, #{param2})
	</insert>
	
	<insert id="storeProductRegister">
	INSERT INTO productInformation(productName, price, category) VALUES(#{param1}, #{param2}, #{param3})
	</insert>
	
	<select id="modalProductList" resultType="branchProduct">
	SELECT *
	FROM productInformation pi
	WHERE pi.category = "상품"
	  AND pi.productID NOT IN (
	    SELECT bp.productID
	    FROM branchProduct bp
	    JOIN branch b ON bp.branchID = b.branchID
	    WHERE b.branchName = #{currentBranchName}
	  )
	</select>
	
	<select id="branchIDSearch">
	SELECT branchID
	FROM branch
	WHERE branchName = #{param1}
	</select>
	
	<select id="productIDSearch">
	SELECT productID
	FROM productInformation
	WHERE productName = #{param1}
	</select>
	
	<insert id="branchProductRegister">
	INSERT INTO branchProduct (branchID, productID) VALUES(#{param1}, #{param2})
	</insert>
</mapper>